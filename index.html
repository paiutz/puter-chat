<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <title>Puter.js Chat</title>
  <style>
    body { margin:0; padding:0; font-family:sans-serif; background:#eef2f5; }
    .chat { display:flex; flex-direction:column; height:100vh; }
    header { background:#4a76a8; color:#fff; padding:1rem; text-align:center; }
    #msgs { flex:1; overflow-y:auto; padding:1rem; }
    .msg { margin-bottom:0.75rem; padding:0.75rem; border-radius:4px; max-width:80%; }
    .user { background:#daf1da; align-self:flex-end; }
    .bot  { background:#f1f1f1; align-self:flex-start; }
    .input { display:flex; border-top:1px solid #ccc; }
    textarea { flex:1; padding:0.5rem; border:none; resize:none; outline:none; }
    button { background:#4a76a8; color:#fff; border:none; padding:0 1rem; }
    button:active { background:#3b5d7a; }
  </style>
</head>
<body>
  <div class="chat">
    <header>Puter.js Chat</header>
    <div id="msgs"></div>
    <div class="input">
      <textarea id="inp" placeholder="Scrivi un messaggio..."></textarea>
      <button id="send">Invia</button>
    </div>
  </div>

  <script src="https://js.puter.com/v2/"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const msgs = document.getElementById('msgs');
      const inp = document.getElementById('inp');
      const sendBtn = document.getElementById('send');

      async function sendMessage() {
        const text = inp.value.trim();
        if (!text) return;
        
        addMsg('user', text);
        inp.value = '';
        addMsg('bot', 'Sto pensando...');
        
        try {
          // SINTASSI CORRETTA per Puter.js
          const response = await puter.ai.chat(text, {
            model: 'claude-3-7-sonnet'
          });
          
          msgs.lastChild.remove();
          addMsg('bot', response.message.content[0].text);
        } catch (error) {
          console.error('Errore:', error);
          msgs.lastChild.remove();
          addMsg('bot', 'Errore: ' + error.message);
        }
      }

      function addMsg(role, txt) {
        const d = document.createElement('div');
        d.className = 'msg ' + role;
        d.textContent = txt;
        msgs.appendChild(d);
        msgs.scrollTop = msgs.scrollHeight;
      }

      sendBtn.addEventListener('click', sendMessage);
      inp.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });
    });
  </script>
</body>
</html>
