<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <title>Puter.js Chat</title>
  <style>
    body { margin:0; padding:0; font-family:sans-serif; background:#eef2f5; }
    .chat { display:flex; flex-direction:column; height:100vh; }
    header { background:#4a76a8; color:#fff; padding:1rem; text-align:center; font-size:1.2rem; }
    #msgs { flex:1; overflow-y:auto; padding:1rem; display:flex; flex-direction:column; }
    .msg { margin-bottom:0.75rem; padding:0.75rem 1rem; border-radius:8px; max-width:80%; }
    .user { background:#daf1da; align-self:flex-end; }
    .bot { background:#f1f1f1; align-self:flex-start; }
    .input { display:flex; border-top:1px solid #ccc; background:#fff; }
    textarea { flex:1; padding:0.75rem; border:none; resize:none; outline:none; font-size:16px; }
    button { background:#4a76a8; color:#fff; border:none; padding:0.75rem 1.5rem; font-size:16px; }
    button:active { background:#3b5d7a; }
    .loading { color:#666; font-style:italic; }
  </style>
</head>
<body>
  <div class="chat">
    <header>ðŸ¤– Puter.js Chat</header>
    <div id="msgs"></div>
    <div class="input">
      <textarea id="inp" placeholder="Scrivi un messaggio..." rows="1"></textarea>
      <button id="send">Invia</button>
    </div>
  </div>

  <script src="https://js.puter.com/v2/puter.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const puter = new Puter({ 
        model: 'claude-3-7-sonnet', 
        temperature: 0.7, 
        top_p: 0.9 
      });
      
      const msgs = document.getElementById('msgs');
      const inp = document.getElementById('inp');
      const send = document.getElementById('send');

      async function sendMessage() {
        const text = inp.value.trim();
        if (!text) return;
        
        addMsg('user', text);
        inp.value = '';
        addMsg('bot', 'Sto pensando...', true);
        
        try {
          const res = await puter.chat([
            { role: 'system', content: 'Sei un assistente AI amichevole e utile.' },
            { role: 'user', content: text }
          ]);
          
          msgs.lastChild.remove();
          addMsg('bot', res.message.content);
        } catch (err) {
          console.error('Errore Puter.js:', err);
          msgs.lastChild.remove();
          addMsg('bot', 'Errore di connessione. Riprova.');
        }
      }

      function addMsg(role, txt, isLoading = false) {
        const d = document.createElement('div');
        d.className = 'msg ' + role + (isLoading ? ' loading' : '');
        d.textContent = txt;
        msgs.appendChild(d);
        msgs.scrollTop = msgs.scrollHeight;
      }

      send.addEventListener('click', sendMessage);
      inp.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });
    });
  </script>
</body>
</html>
